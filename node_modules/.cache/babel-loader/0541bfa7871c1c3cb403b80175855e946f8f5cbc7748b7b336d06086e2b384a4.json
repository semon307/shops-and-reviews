{"ast":null,"code":"import { createSlice } from '@reduxjs/toolkit';\nimport { buildQueryString } from '../utils/build-query-string';\nimport { shopsApi } from '../api/shops-api';\nconst initialState = {\n  shopsRequests: {},\n  totalPageCount: {},\n  isLoading: false,\n  error: null\n};\nconst slice = createSlice({\n  name: 'shopsReducer',\n  initialState: initialState,\n  reducers: {\n    setShopsAC(state, action) {\n      const {\n        shops,\n        totalPageCount,\n        filters,\n        searchQuery\n      } = action.payload;\n      state.shopsRequests = {\n        [searchQuery]: shops\n      };\n      state.totalPageCount = {\n        [String(filters.searchTerm)]: totalPageCount\n      };\n    },\n    setLoadingAC(state, action) {\n      state.isLoading = action.payload;\n    },\n    setErrorAC(state, action) {\n      state.error = action.payload;\n    }\n  }\n});\nexport const shopsReducer = slice.reducer;\nexport const setShopsAC = slice.actions.setShopsAC;\nconst setLoadingAC = slice.actions.setLoadingAC;\nconst setErrorAC = slice.actions.setErrorAC;\nexport const setShopsTC = filters => dispatch => {\n  dispatch(setErrorAC(null));\n  dispatch(setLoadingAC(true));\n  const searchQuery = buildQueryString(filters);\n  shopsApi.getShops(searchQuery).then(res => {\n    var _res$data, _res$data2, _res$data2$metaData;\n    dispatch(setShopsAC({\n      shops: res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.shops,\n      filters,\n      searchQuery,\n      totalPageCount: res === null || res === void 0 ? void 0 : (_res$data2 = res.data) === null || _res$data2 === void 0 ? void 0 : (_res$data2$metaData = _res$data2.metaData) === null || _res$data2$metaData === void 0 ? void 0 : _res$data2$metaData.totalPageCount\n    }));\n  }).catch(error => {\n    dispatch({\n      type: 'shops/error',\n      payload: error.message\n    });\n    dispatch(setErrorAC('Something went wrong:('));\n  }).finally(() => {\n    dispatch(setLoadingAC(false));\n  });\n};","map":{"version":3,"names":["createSlice","buildQueryString","shopsApi","initialState","shopsRequests","totalPageCount","isLoading","error","slice","name","reducers","setShopsAC","state","action","shops","filters","searchQuery","payload","String","searchTerm","setLoadingAC","setErrorAC","shopsReducer","reducer","actions","setShopsTC","dispatch","getShops","then","res","_res$data","_res$data2","_res$data2$metaData","data","metaData","catch","type","message","finally"],"sources":["/Applications/work/test_tasks/coding-challenge-consumer-semen/src/redux/shops-reducer.ts"],"sourcesContent":["import { Dispatch } from 'redux';\nimport { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { buildQueryString } from '../utils/build-query-string';\nimport { Shop } from './types/shop/shop';\nimport { shopsApi } from '../api/shops-api';\nimport { ShopsFilters } from './types/shop/shop-filters';\n\nexport type ShopsState = {\n  shopsRequests: {\n    [searchQuery: string]: Array<Shop>;\n  };\n  totalPageCount: {\n    [searchTerm: string]: number;\n  };\n  isLoading: boolean;\n  error: string | null;\n};\n\nconst initialState: ShopsState = {\n  shopsRequests: {},\n  totalPageCount: {},\n  isLoading: false,\n  error: null,\n};\nconst slice = createSlice({\n  name: 'shopsReducer',\n  initialState: initialState,\n  reducers: {\n    setShopsAC(\n      state,\n      action: PayloadAction<{ shops: Array<Shop>; totalPageCount: number; filters: ShopsFilters; searchQuery: string; }>\n    )\n    {\n      const { shops, totalPageCount, filters, searchQuery } = action.payload;\n      state.shopsRequests = {\n        [searchQuery]: shops,\n      };\n      state.totalPageCount = {\n        [String(filters.searchTerm)]: totalPageCount,\n      };\n    },\n    setLoadingAC(state, action: PayloadAction<boolean>) {\n      state.isLoading = action.payload;\n    },\n    setErrorAC(state, action: PayloadAction<string | null>) {\n      state.error = action.payload;\n    },\n  }\n});\n\nexport const shopsReducer = slice.reducer;\nexport const setShopsAC = slice.actions.setShopsAC;\nconst setLoadingAC = slice.actions.setLoadingAC;\nconst setErrorAC = slice.actions.setErrorAC;\n\n\nexport const setShopsTC = (filters: ShopsFilters) => (dispatch: Dispatch) => {\n  dispatch(setErrorAC(null));\n  dispatch(setLoadingAC(true));\n  const searchQuery = buildQueryString(filters);\n  shopsApi.getShops(searchQuery)\n    .then((res) => {\n      dispatch(setShopsAC({\n        shops: res?.data?.shops,\n        filters,\n        searchQuery,\n        totalPageCount: res?.data?.metaData?.totalPageCount\n      }));\n    })\n    .catch((error) => {\n      dispatch({ type: 'shops/error', payload: error.message });\n      dispatch(setErrorAC('Something went wrong:('));\n    })\n    .finally(() => {\n      dispatch(setLoadingAC(false));\n    });\n};\n"],"mappings":"AACA,SAASA,WAAW,QAAuB,kBAAkB;AAC7D,SAASC,gBAAgB,QAAQ,6BAA6B;AAE9D,SAASC,QAAQ,QAAQ,kBAAkB;AAc3C,MAAMC,YAAwB,GAAG;EAC/BC,aAAa,EAAE,CAAC,CAAC;EACjBC,cAAc,EAAE,CAAC,CAAC;EAClBC,SAAS,EAAE,KAAK;EAChBC,KAAK,EAAE;AACT,CAAC;AACD,MAAMC,KAAK,GAAGR,WAAW,CAAC;EACxBS,IAAI,EAAE,cAAc;EACpBN,YAAY,EAAEA,YAAY;EAC1BO,QAAQ,EAAE;IACRC,UAAUA,CACRC,KAAK,EACLC,MAAkH,EAEpH;MACE,MAAM;QAAEC,KAAK;QAAET,cAAc;QAAEU,OAAO;QAAEC;MAAY,CAAC,GAAGH,MAAM,CAACI,OAAO;MACtEL,KAAK,CAACR,aAAa,GAAG;QACpB,CAACY,WAAW,GAAGF;MACjB,CAAC;MACDF,KAAK,CAACP,cAAc,GAAG;QACrB,CAACa,MAAM,CAACH,OAAO,CAACI,UAAU,CAAC,GAAGd;MAChC,CAAC;IACH,CAAC;IACDe,YAAYA,CAACR,KAAK,EAAEC,MAA8B,EAAE;MAClDD,KAAK,CAACN,SAAS,GAAGO,MAAM,CAACI,OAAO;IAClC,CAAC;IACDI,UAAUA,CAACT,KAAK,EAAEC,MAAoC,EAAE;MACtDD,KAAK,CAACL,KAAK,GAAGM,MAAM,CAACI,OAAO;IAC9B;EACF;AACF,CAAC,CAAC;AAEF,OAAO,MAAMK,YAAY,GAAGd,KAAK,CAACe,OAAO;AACzC,OAAO,MAAMZ,UAAU,GAAGH,KAAK,CAACgB,OAAO,CAACb,UAAU;AAClD,MAAMS,YAAY,GAAGZ,KAAK,CAACgB,OAAO,CAACJ,YAAY;AAC/C,MAAMC,UAAU,GAAGb,KAAK,CAACgB,OAAO,CAACH,UAAU;AAG3C,OAAO,MAAMI,UAAU,GAAIV,OAAqB,IAAMW,QAAkB,IAAK;EAC3EA,QAAQ,CAACL,UAAU,CAAC,IAAI,CAAC,CAAC;EAC1BK,QAAQ,CAACN,YAAY,CAAC,IAAI,CAAC,CAAC;EAC5B,MAAMJ,WAAW,GAAGf,gBAAgB,CAACc,OAAO,CAAC;EAC7Cb,QAAQ,CAACyB,QAAQ,CAACX,WAAW,CAAC,CAC3BY,IAAI,CAAEC,GAAG,IAAK;IAAA,IAAAC,SAAA,EAAAC,UAAA,EAAAC,mBAAA;IACbN,QAAQ,CAACf,UAAU,CAAC;MAClBG,KAAK,EAAEe,GAAG,aAAHA,GAAG,wBAAAC,SAAA,GAAHD,GAAG,CAAEI,IAAI,cAAAH,SAAA,uBAATA,SAAA,CAAWhB,KAAK;MACvBC,OAAO;MACPC,WAAW;MACXX,cAAc,EAAEwB,GAAG,aAAHA,GAAG,wBAAAE,UAAA,GAAHF,GAAG,CAAEI,IAAI,cAAAF,UAAA,wBAAAC,mBAAA,GAATD,UAAA,CAAWG,QAAQ,cAAAF,mBAAA,uBAAnBA,mBAAA,CAAqB3B;IACvC,CAAC,CAAC,CAAC;EACL,CAAC,CAAC,CACD8B,KAAK,CAAE5B,KAAK,IAAK;IAChBmB,QAAQ,CAAC;MAAEU,IAAI,EAAE,aAAa;MAAEnB,OAAO,EAAEV,KAAK,CAAC8B;IAAQ,CAAC,CAAC;IACzDX,QAAQ,CAACL,UAAU,CAAC,wBAAwB,CAAC,CAAC;EAChD,CAAC,CAAC,CACDiB,OAAO,CAAC,MAAM;IACbZ,QAAQ,CAACN,YAAY,CAAC,KAAK,CAAC,CAAC;EAC/B,CAAC,CAAC;AACN,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}