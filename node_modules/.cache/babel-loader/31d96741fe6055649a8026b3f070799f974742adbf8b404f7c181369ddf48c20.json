{"ast":null,"code":"import { createSlice } from '@reduxjs/toolkit';\nimport { reviewsApi } from '../api/reviews-api';\nimport { SortOrder } from '../utils/common/sort-order';\nimport { sortArrayByCreationDate } from '../utils/sort-array-by-creation-date';\nimport { mapReviewsRaw } from './mappers/map-reviews-raw';\nconst initialState = {};\nconst slice = createSlice({\n  name: 'ReviewsReducer',\n  initialState: initialState,\n  reducers: {\n    setReviewsAC(state, action) {\n      state[action.payload.tsId] = {\n        ...state[action.payload.tsId],\n        reviews: action.payload.reviews\n      };\n    },\n    setLoadingAC(state, action) {\n      var _action$payload;\n      state[action.payload.tsId] = {\n        ...state[action.payload.tsId],\n        isLoading: (_action$payload = action.payload) === null || _action$payload === void 0 ? void 0 : _action$payload.isLoading\n      };\n    },\n    setErrorAC(state, action) {\n      var _action$payload2;\n      state[action.payload.tsId] = {\n        ...state[action.payload.tsId],\n        error: (_action$payload2 = action.payload) === null || _action$payload2 === void 0 ? void 0 : _action$payload2.error\n      };\n    }\n  }\n});\nexport const reviewsReducer = slice.reducer;\nexport const setReviewsAC = slice.actions.setReviewsAC;\nexport const setLoadingAC = slice.actions.setLoadingAC;\nexport const setErrorAC = slice.actions.setErrorAC;\nexport const setReviewsTC = tsId => dispatch => {\n  dispatch(setLoadingAC({\n    tsId,\n    isLoading: true\n  }));\n  dispatch(setErrorAC({\n    tsId,\n    error: null\n  }));\n  reviewsApi.getReviews(tsId).then(res => {\n    var _res$data$response$da, _res$data$response$da2;\n    const mappedReviews = mapReviewsRaw((_res$data$response$da = res.data.response.data) === null || _res$data$response$da === void 0 ? void 0 : (_res$data$response$da2 = _res$data$response$da.shop) === null || _res$data$response$da2 === void 0 ? void 0 : _res$data$response$da2.reviews);\n    dispatch(setReviewsAC({\n      reviews: sortArrayByCreationDate(mappedReviews, SortOrder.DESCENDING),\n      tsId\n    }));\n  }).catch(error => {\n    dispatch({\n      type: 'reviews/error',\n      payload: error.message\n    });\n    dispatch(setErrorAC({\n      tsId,\n      error: 'Something went wrong:('\n    }));\n  }).finally(() => {\n    dispatch(setLoadingAC({\n      tsId,\n      isLoading: false\n    }));\n  });\n};","map":{"version":3,"names":["createSlice","reviewsApi","SortOrder","sortArrayByCreationDate","mapReviewsRaw","initialState","slice","name","reducers","setReviewsAC","state","action","payload","tsId","reviews","setLoadingAC","_action$payload","isLoading","setErrorAC","_action$payload2","error","reviewsReducer","reducer","actions","setReviewsTC","dispatch","getReviews","then","res","_res$data$response$da","_res$data$response$da2","mappedReviews","data","response","shop","DESCENDING","catch","type","message","finally"],"sources":["/Applications/work/test_tasks/coding-challenge-consumer-semen/src/redux/reviews-reducer.ts"],"sourcesContent":["import { createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { Dispatch } from 'redux';\nimport { reviewsApi } from '../api/reviews-api';\nimport { SortOrder } from '../utils/common/sort-order';\nimport { sortArrayByCreationDate } from '../utils/sort-array-by-creation-date';\nimport { mapReviewsRaw } from './mappers/map-reviews-raw';\nimport { Review } from './types/review/review';\n\nexport type ReviewsState = {\n  [tsId: string]: {\n    reviews: Array<Review>;\n    isLoading: boolean;\n    error: string | null;\n  };\n};\n\nconst initialState: ReviewsState = {};\nconst slice = createSlice({\n  name: 'ReviewsReducer',\n  initialState: initialState,\n  reducers: {\n    setReviewsAC(state, action: PayloadAction<{ tsId: string; reviews: Array<Review>; }>) {\n      state[action.payload.tsId] = {\n        ...state[action.payload.tsId],\n        reviews: action.payload.reviews\n      };\n    },\n    setLoadingAC(state, action: PayloadAction<{ tsId: string; isLoading: boolean; }>) {\n      state[action.payload.tsId] = {\n        ...state[action.payload.tsId],\n        isLoading: action.payload?.isLoading,\n      };\n    },\n    setErrorAC(state, action: PayloadAction<{tsId: string; error: string | null;}>) {\n      state[action.payload.tsId] = {\n        ...state[action.payload.tsId],\n        error: action.payload?.error,\n      };\n    },\n  }\n});\n\nexport const reviewsReducer = slice.reducer;\nexport const setReviewsAC = slice.actions.setReviewsAC;\nexport const setLoadingAC = slice.actions.setLoadingAC;\nexport const setErrorAC = slice.actions.setErrorAC;\n\n\nexport const setReviewsTC = (tsId: string) => (dispatch: Dispatch) => {\n  dispatch(setLoadingAC({tsId, isLoading: true}));\n  dispatch(setErrorAC({tsId, error: null}));\n  reviewsApi.getReviews(tsId)\n    .then((res) => {\n      const mappedReviews = mapReviewsRaw(res.data.response.data?.shop?.reviews);\n      dispatch(setReviewsAC(\n        { reviews: sortArrayByCreationDate(mappedReviews, SortOrder.DESCENDING),\n          tsId })\n      );\n    })\n    .catch((error) => {\n      dispatch({ type: 'reviews/error', payload: error.message });\n      dispatch(setErrorAC({tsId, error: 'Something went wrong:('}));\n    })\n    .finally(() => {\n      dispatch(setLoadingAC({tsId, isLoading: false}));\n    });\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}